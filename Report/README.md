# ЛАБ 3

Лабораторную работу начинаю с настройки первой виртуальной машины А. В качестве нее я буду использовать ту, которая уже у меня установлена и на которой я выполняла все предыдащие лабораторные. На ней необходимо обеспечить доступ в сеть интернет. Для этого открываю VirtualBox и выбираю виртуальную машину, для которой хочу настроить доступ в интернет. Открываю настройки ВМ, выбираю раздел "Сеть", убеждаюсь, что включен сетевой адаптер. В типе подлючения изначально стоял NAT (Network Address Translation), он мне и нужен. NAT позволяет виртуальной машине использовать айпи-адрес хоста для выхода в интернет, это обеспечивает доступ в сеть без использования доп настроек. *(рис.1)*

![рис.1](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис1.png)

Далее я запускаю ВМ, открываю терминал, проверяю наличие доступа в интернет с помощью команды *ping*.
```bash
ping google.com
```
Получаю следующий ответ от ВМ. *(рис.2)* Это означает, что доступ в интернет успешно настроен. Пинг до сервера Google (142.250.179.78) прошел успешно, все пакеты были отправлены и получены без потерь, что подтверждает наличие подключения.

![рис.2](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис2.png)

Обычным образом устанавливаю вторую ВМ - VM_B. Далее мне необходимо настроить сетевые адаптеры. Снова открываю настройки вм-1, выбираю раздел "Сеть" и подключаю 2ой сетевой адаптер. Устанаваливаю на нём режим "Виртуальный адаптер хоста". Это обеспечит связь между VM_A и VM_B. *(рис.3)*

![рис.3](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис3.png)

Теперь открываю настройки второй ВМ, там снова захожу в раздел "Сеть", выбираю адаптер-1 и там устанавливаю режим "Виртуальный адаптер хоста". *(рис.4)*

![рис.4](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис4.png)

Следующим шагом я запускаю обе виртуальные машины и перехожу к настройке сети между ними.
Открываю терминал на VM_A и на VM_B и выполняю команду, чтобы увидеть сетевые интерфейсы и их айпи-адреса:
```bash
ip a
```
Получаю вот такой ответ на VM_A: *(рис.5)*

![рис.5](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис5.png)

Получаю вот такой ответ на VM_B: *(рис.6)*

![рис.6](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис6.png)

Получается, настроены такие интерфейсы:

*lo* - стандартный интерфейс loopback (локальный интерфейс), который используется для связи внутри компьютера, его айпи-адрес — 127.0.0.1. на машине А и аналогичный на машине В

*enp0s3* - интерфейс используется для подключения к интернету через NAT, его айпи-адрес 10.0.2.15. на машине А и 192.168.56.102 на машине В

*enp0s8* - интерфейс, связанный как раз с виртуальным адаптером хоста, ему уже присвоен айпи-адрес 192.168.56.101 на машине А, это говорит о том, что он правильно настроен

Убеждаюсь, что айпи-адреса на ВМ А и В находятся в одной подсети. Теперь мы можем проверить связь между машинами, с помощью пинга. 
На вм-А ввожу команду:
```bash
ping 192.168.56.102
```
Получаю ответ: *(рис.7)*

![рис.7](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис7.png)

На вм-B ввожу команду:
```bash
ping 192.168.56.101
```

Получаю ответ: *(рис.8)*

![рис.8](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис8.png)

Таким образом, я вижу, что пинг проходит на обоих машинах, значит соединение установлено.

Теперь аналогичным образом создаю и запускаю машину С, там снова захожу в раздел "Сеть", выбираю адаптер-1 и там устанавливаю режим "Виртуальный адаптер хоста".
Запускаю команду *ip a*, получаю такой результат: *(рис.9)*

![рис.9](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис9.png)

Здесь я вижу, что у этой машины у *enp0s3* айпи-адрес - 192.168.56.103
Из первой ВМ во вторую и наоброт доступ уже настроен, проверяю есть ли доступ из машины А в третью машину - С. В терминале машины А снова ввожу пинг:
```bash
ping 192.168.56.103
```
Вижу результат, показывающий, что доступ настроен: *(рис.10)*

![рис.10](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис10.png)

Чтобы убрать доступ из машины В к машине С, для начала дам себе права sudo на машине В. Для этого пишу:
```bash
su root
nano /etc/sudoers
```
Я переключаюсь на пользователя root, потому что alenk не может выполнять никаких административных задач. После того, как я переключилась, я буду редактировать файл sudoers, используя nano. Это текстовый редактор, который дает возможность редактировать файлы из командной строки. Я дописываю новую строку в привилегии пользователя. Это предоставило мне, как обычному пользователю, привилегии суперпользователя, и теперь я могу выполнять задачи, требующие root-доступа. 

![sudo](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/sudo.png)

Теперь я ввожу такую команду: 
```bash
sudo iptables -A INPUT -s 192.168.56.102 -j DROP
sudo iptables -P INPUT DROP
sudo iptables-save
```
**sudo** — выполняет команду от имени root

**iptables** — команда для управления таблицами фильтрации пакетов

**-A INPUT** — добавляет правило в цепочку INPUT, то есть правило будет применяться ко всем входящим пакетам

**-s 192.168.56.102** — указывает источник пакетов, здесь это айпи-адрес машины B.

**-j DROP** — указывает, что нужно сделать с пакетами, которые соответствуют этому правилу, в данной ситуации это значит не передавать их дальше

**-P** - устанавливает политику по умолчанию для цепочки, которая обрабатывает входящие пакеты

**iptables-save** - сохраняет правило

После этого проверяю, есть ли сетевой доступ от машины В к машине С: *(рис.11)*

![рис.11](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис11.png)

Пинг не проходит, значит доступа нет! Начинаю проверять окончательные результаты на всех трех машинах, выяснилось, что потерян доступ от машины А к машине В. Чтобы это исправить, я ввожу команды на машине В:

```bash
sudo iptables -A INPUT -s 192.168.56.101 -j ACCEPT
sudo iptables-save
```
Это правило восстанавливает доступ к машине А.

Теперь все окончательные варианты верны: настроен доступ от ВМ-А к машинам В и С, и наоброт, а между машинами В и С доступа нет: *(рис.12, 13, 14)*

![рис.12](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис12.png)
![рис.13](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис13.png)
![рис.14](https://github.com/a-orlova/lab3-orlova-a-a/blob/main/рис14.png)

**Лабораторная работа выполнена**, доступ настроен верно!
