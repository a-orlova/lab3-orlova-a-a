# ЛАБ 3

Лабораторную работу начинаю с настройки первой виртуальной машины А. В качестве нее я буду использовать ту, которая уже у меня установлена и на которой я выполняла все предыдащие лабораторные. На ней необходимо обеспечить доступ в сеть интернет. Для этого открываю VirtualBox и выбираю виртуальную машину, для которой хочу настроить доступ в интернет. Открываю настройки ВМ, выбираю раздел "Сеть", убеждаюсь, что включен сетевой адаптер. В типе подлючения изначально стоял NAT (Network Address Translation), он мне и нужен. NAT позволяет виртуальной машине использовать айпи-адрес хоста для выхода в интернет, это обеспечивает доступ в сеть без использования доп настроек. 

![рис1](https://github.com/user-attachments/assets/65ce9e98-0276-4e87-b373-9ea514921d10)

Далее я запускаю ВМ, открываю терминал, проверяю наличие доступа в интернет с помощью команды *ping*.
```bash
ping google.com
```
Получаю следующий ответ от ВМ. Это означает, что доступ в интернет успешно настроен. Пинг до сервера Google (142.250.179.78) прошел успешно, все пакеты были отправлены и получены без потерь, что подтверждает наличие подключения.

![рис2](https://github.com/user-attachments/assets/7f492bc8-46bc-4f7d-be4b-e6a5f42adc1d)

Обычным образом устанавливаю вторую ВМ - VM_B. Далее мне необходимо настроить сетевые адаптеры. Снова открываю настройки вм-1, выбираю раздел "Сеть" и подключаю 2ой сетевой адаптер. Устанаваливаю на нём режим "Виртуальный адаптер хоста". Это обеспечит связь между VM_A и VM_B. 

![рис3](https://github.com/user-attachments/assets/43aa2a31-a686-47c8-8dc3-7191bb6e67c5)

Теперь открываю настройки второй ВМ, там снова захожу в раздел "Сеть", выбираю адаптер-1 и там устанавливаю режим "Виртуальный адаптер хоста". 

![рис4](https://github.com/user-attachments/assets/9860382e-1d9a-4da1-9fec-9e36137578df)

Следующим шагом я запускаю обе виртуальные машины и перехожу к настройке сети между ними.
Открываю терминал на VM_A и на VM_B и выполняю команду, чтобы увидеть сетевые интерфейсы и их айпи-адреса:
```bash
ip a
```
Получаю вот такой ответ на VM_A: 

![рис5](https://github.com/user-attachments/assets/c2c426b1-0d4d-48f6-a720-f62dd2edc523)


Получаю вот такой ответ на VM_B: 

![рис6](https://github.com/user-attachments/assets/9575a94a-80e3-4945-a54b-001aea170a1f)

Получается, настроены такие интерфейсы:

*lo* - стандартный интерфейс loopback (локальный интерфейс), который используется для связи внутри компьютера, его айпи-адрес — 127.0.0.1. на машине А и аналогичный на машине В

*enp0s3* - интерфейс используется для подключения к интернету через NAT, его айпи-адрес 10.0.2.15. на машине А и 192.168.56.102 на машине В

*enp0s8* - интерфейс, связанный как раз с виртуальным адаптером хоста, ему уже присвоен айпи-адрес 192.168.56.101 на машине А, это говорит о том, что он правильно настроен

Убеждаюсь, что айпи-адреса на ВМ А и В находятся в одной подсети. Теперь мы можем проверить связь между машинами, с помощью пинга. 
На вм-А ввожу команду:
```bash
ping 192.168.56.102
```
Получаю ответ: 

![рис7](https://github.com/user-attachments/assets/dad0a264-ef2b-45bc-9f46-d97bdd7fe31a)

На вм-B ввожу команду:
```bash
ping 192.168.56.101
```

Получаю ответ:

![рис8](https://github.com/user-attachments/assets/91a982c2-6776-442d-92a0-d6aa5aa0d77b)

Таким образом, я вижу, что пинг проходит на обоих машинах, значит соединение установлено.

Теперь аналогичным образом создаю и запускаю машину С, там снова захожу в раздел "Сеть", выбираю адаптер-1 и там устанавливаю режим "Виртуальный адаптер хоста".
Запускаю команду *ip a*, получаю такой результат: 

![рис9](https://github.com/user-attachments/assets/f89a17b1-bda7-4c95-9ec4-96b7eba0745c)


Здесь я вижу, что у этой машины у *enp0s3* айпи-адрес - 192.168.56.103
Из первой ВМ во вторую и наоброт доступ уже настроен, проверяю есть ли доступ из машины А в третью машину - С. В терминале машины А снова ввожу пинг:
```bash
ping 192.168.56.103
```
Вижу результат, показывающий, что доступ настроен: 

![рис10](https://github.com/user-attachments/assets/9e94d213-1d3f-48d7-b038-76c68115ef60)

Чтобы убрать доступ из машины В к машине С, для начала дам себе права sudo на машине В. Для этого пишу:
```bash
su root
nano /etc/sudoers
```
Я переключаюсь на пользователя root, потому что alenk не может выполнять никаких административных задач. После того, как я переключилась, я буду редактировать файл sudoers, используя nano. Это текстовый редактор, который дает возможность редактировать файлы из командной строки. Я дописываю новую строку в привилегии пользователя. Это предоставило мне, как обычному пользователю, привилегии суперпользователя, и теперь я могу выполнять задачи, требующие root-доступа. 

![sudo](https://github.com/user-attachments/assets/d7065a7c-82df-4a0f-9773-14aaeb8c60f1)

Теперь я ввожу такую команду: 
```bash
sudo iptables -A INPUT -s 192.168.56.102 -j DROP
sudo iptables -P INPUT DROP
sudo iptables-save
```
**sudo** — выполняет команду от имени root

**iptables** — команда для управления таблицами фильтрации пакетов

**-A INPUT** — добавляет правило в цепочку INPUT, то есть правило будет применяться ко всем входящим пакетам

**-s 192.168.56.102** — указывает источник пакетов, здесь это айпи-адрес машины B.

**-j DROP** — указывает, что нужно сделать с пакетами, которые соответствуют этому правилу, в данной ситуации это значит не передавать их дальше

**-P** - устанавливает политику по умолчанию для цепочки, которая обрабатывает входящие пакеты

**iptables-save** - сохраняет правило

После этого проверяю, есть ли сетевой доступ от машины В к машине С: 

![рис11](https://github.com/user-attachments/assets/6bca621d-cf08-41da-89e1-7022b22513bf)

Пинг не проходит, значит доступа нет! Начинаю проверять окончательные результаты на всех трех машинах, выяснилось, что потерян доступ от машины А к машине В. Чтобы это исправить, я ввожу команды на машине В:

```bash
sudo iptables -A INPUT -s 192.168.56.101 -j ACCEPT
sudo iptables-save
```
Это правило восстанавливает доступ к машине А.

Теперь все окончательные варианты верны: настроен доступ от ВМ-А к машинам В и С, и наоброт, а между машинами В и С доступа нет: 

![рис12](https://github.com/user-attachments/assets/9317bf45-4d81-4cf0-8ca3-6acbc17f64f5)
![рис13](https://github.com/user-attachments/assets/fe1cd2cd-0dba-4154-a96c-85edc21cfbd8)
![рис14](https://github.com/user-attachments/assets/3aa77e1c-ae25-4ec1-8a07-15a6569c02c7)

**Лабораторная работа выполнена**, доступ настроен верно!
